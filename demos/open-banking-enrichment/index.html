<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Open Banking Transaction Enrichment — Systems</title>
  <meta name="description" content="AI-powered transaction categorization using NLP to extract merchant names, categories, and anomaly signals from raw Open Banking data." />
  <link rel="icon" href="/favicon.svg" />
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <header class="nav">
    <div class="inner">
      <div class="brand">
        <img src="/logo.svg" alt="Neuromorphic Inference Lab" />
        <span>Neuromorphic Inference Lab</span>
      </div>
      <nav class="navlinks" aria-label="Primary navigation">
        <a data-nav href="/">Signal</a>
        <a data-nav class="active" href="/demos/">Systems</a>
        <a data-nav href="/evidence/">Proof Ledger</a>
        <a data-nav href="/about/">Identity</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <p class="kicker">AI-Powered Transaction Intelligence</p>
      <h1 class="h1">Open Banking Transaction Enrichment</h1>
      <p class="sub">
        Transform raw, noisy transaction descriptions into structured, actionable intelligence.
        Uses advanced NLP patterns to extract merchant names, categorize spending, and detect anomalies—
        outperforming simple regex by handling unseen merchants and multi-language noise.
      </p>

      <div class="badges">
        <span class="badge">NLP Categorization</span>
        <span class="badge">Merchant Extraction</span>
        <span class="badge">Multi-Language Support</span>
        <span class="badge">Anomaly Detection</span>
        <span class="badge live">Live Demo</span>
      </div>
    </section>

    <section class="section">
      <div class="grid">
        <article class="card col-6">
          <h3>The Problem</h3>
          <p>
            Open Banking APIs return transaction descriptions like <code>"POS 4839 XYZ SRL 02/11 MILANO IT"</code>
            that are difficult to analyze. Traditional rule-based systems struggle with:
          </p>
          <ul class="clean">
            <li>Unseen merchant names and abbreviations</li>
            <li>Multi-language transaction text (IT, ES, FR, DE)</li>
            <li>POS codes, card numbers, and noise</li>
            <li>Inconsistent formatting across banks</li>
          </ul>

          <h3 class="mt-12">The Solution</h3>
          <p>
            AI-powered enrichment engine that uses semantic patterns and contextual analysis to:
          </p>
          <ul class="clean">
            <li><strong>Extract</strong> clean merchant names</li>
            <li><strong>Categorize</strong> into spending types (Home, Transport, Food, etc.)</li>
            <li><strong>Detect</strong> signals (recurring subscriptions, anomalies)</li>
            <li><strong>Handle</strong> multi-language noise intelligently</li>
          </ul>
        </article>

        <article class="card col-6">
          <h3>Live Enrichment Demo</h3>
          <p class="small">
            Enter raw transaction descriptions to see AI-powered enrichment vs. rule-based extraction.
          </p>

          <div class="panel">
            <label><span class="small">Raw Transaction Description</span>
              <input 
                id="input-transaction" 
                type="text" 
                class="input" 
                placeholder="e.g., POS 4839 STARBUCKS MILANO 02/11 IT"
                value="POS 4839 STARBUCKS COFFEE MILANO 02/11 IT"
              />
            </label>

            <div class="actions mt-12">
              <button id="enrich-btn" class="btn primary">Enrich Transaction</button>
              <button id="batch-btn" class="btn">Try Batch Examples</button>
              <button id="clear-btn" class="btn">Clear</button>
            </div>
          </div>

          <div id="output" class="mt-16"></div>
        </article>
      </div>
    </section>

    <section class="section">
      <h2>AI vs. Rule-Based Comparison</h2>
      <p class="lead">
        See how AI-powered extraction handles edge cases that break traditional regex patterns.
      </p>

      <div id="comparison-output"></div>
    </section>

    <section class="section">
      <h2>Technical Implementation</h2>
      <div class="grid">
        <div class="col-6">
          <div class="card">
            <h3>NLP Extraction Pipeline</h3>
            <ul class="clean">
              <li>Tokenization with noise filtering</li>
              <li>Entity recognition for merchant names</li>
              <li>Semantic similarity for categorization</li>
              <li>Pattern matching for recurring signals</li>
              <li>Multi-language stopword handling</li>
            </ul>
          </div>
        </div>

        <div class="col-6">
          <div class="card">
            <h3>Category Taxonomy</h3>
            <ul class="clean">
              <li><strong>Home:</strong> Utilities, maintenance, rent</li>
              <li><strong>Transport:</strong> Fuel, parking, public transit</li>
              <li><strong>Food:</strong> Groceries, restaurants, cafes</li>
              <li><strong>Shopping:</strong> Retail, online, clothing</li>
              <li><strong>Entertainment:</strong> Streaming, events, leisure</li>
              <li><strong>Health:</strong> Pharmacy, medical, wellness</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div>© <span id="year"></span> Neuromorphic Inference Lab</div>
      <div class="prov">
        <span id="build-branch">branch: …</span>
        <span id="build-commit">commit: …</span>
        <span id="build-time">built: …</span>
      </div>
    </footer>
  </main>

  <script>
    document.getElementById("year").textContent = String(new Date().getFullYear());

    // Advanced Transaction Enrichment Engine
    class TransactionEnricher {
      constructor() {
        // Multi-language stopwords for noise filtering
        this.stopwords = new Set([
          'pos', 'card', 'payment', 'purchase', 'transaction', 'tx', 'txn',
          'debit', 'credit', 'atm', 'cash', 'withdrawal', 'deposit',
          // Italian
          'pagamento', 'acquisto', 'carta', 'prelievo',
          // Spanish  
          'pago', 'compra', 'tarjeta', 'retiro',
          // French
          'paiement', 'achat', 'carte', 'retrait',
          // German
          'zahlung', 'kauf', 'karte', 'abhebung'
        ]);

        // Enhanced category patterns with semantic keywords
        this.categories = {
          'Home': {
            keywords: ['electric', 'gas', 'water', 'rent', 'mortgage', 'internet', 'phone', 'mobile', 
                      'enel', 'eni', 'vodafone', 'tim', 'wind', 'fastweb', 'telecom'],
            weight: 1.2
          },
          'Transport': {
            keywords: ['uber', 'lyft', 'taxi', 'train', 'bus', 'metro', 'parking', 'fuel', 'petrol', 
                      'shell', 'bp', 'esso', 'trenitalia', 'atm', 'metro'],
            weight: 1.1
          },
          'Food': {
            keywords: ['starbucks', 'coffee', 'cafe', 'restaurant', 'pizza', 'food', 'grocery', 'supermarket',
                      'tesco', 'sainsbury', 'asda', 'morrisons', 'coop', 'esselunga', 'carrefour', 'lidl'],
            weight: 1.0
          },
          'Shopping': {
            keywords: ['amazon', 'ebay', 'shop', 'store', 'retail', 'mall', 'boutique',
                      'zara', 'h&m', 'nike', 'adidas', 'ikea'],
            weight: 0.9
          },
          'Entertainment': {
            keywords: ['netflix', 'spotify', 'cinema', 'theatre', 'concert', 'game', 'steam',
                      'playstation', 'xbox', 'apple', 'music'],
            weight: 0.8
          },
          'Health': {
            keywords: ['pharmacy', 'medical', 'doctor', 'hospital', 'clinic', 'gym', 'fitness',
                      'farmacia', 'medico', 'ospedale'],
            weight: 1.0
          }
        };

        // Recurring pattern indicators
        this.recurringPatterns = [
          /subscription/i, /monthly/i, /annual/i, /recurring/i,
          /netflix/i, /spotify/i, /amazon prime/i, /gym/i
        ];
      }

      // Main enrichment method
      enrich(rawDescription) {
        const cleaned = this.cleanDescription(rawDescription);
        const merchant = this.extractMerchant(rawDescription);
        const category = this.categorize(cleaned, merchant);
        const signals = this.detectSignals(rawDescription, category);

        return {
          raw: rawDescription,
          cleaned: cleaned,
          merchant: merchant,
          category: category,
          signals: signals,
          confidence: this.calculateConfidence(merchant, category, signals)
        };
      }

      // Clean and normalize description
      cleanDescription(desc) {
        // Remove common noise patterns
        let cleaned = desc
          .replace(/\b\d{4,}\b/g, '') // Remove long numbers (card refs, POS codes)
          .replace(/\b\d{1,2}\/\d{1,2}\b/g, '') // Remove dates
          .replace(/[^\w\s]/g, ' ') // Remove special chars
          .replace(/\s+/g, ' ') // Normalize spaces
          .trim()
          .toLowerCase();

        // Remove stopwords
        const words = cleaned.split(' ').filter(word => 
          word.length > 2 && !this.stopwords.has(word)
        );

        return words.join(' ');
      }

      // Extract merchant name using NLP patterns
      extractMerchant(desc) {
        // Remove POS codes and card references
        let merchant = desc
          .replace(/\bPOS\s*\d+\b/gi, '')
          .replace(/\bCARD\s*\d+\b/gi, '')
          .replace(/\b\d{4,}\b/g, '')
          .trim();

        // Extract merchant name (typically first 1-3 meaningful words)
        const words = merchant.split(/\s+/).filter(w => 
          w.length > 2 && 
          !this.stopwords.has(w.toLowerCase()) &&
          !/^\d+$/.test(w)
        );

        // Take first 2-3 words as merchant name
        const merchantName = words.slice(0, Math.min(3, words.length)).join(' ');
        
        // Capitalize each word
        return merchantName
          .split(' ')
          .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
          .join(' ');
      }

      // AI-based categorization using semantic matching
      categorize(cleaned, merchant) {
        const text = `${cleaned} ${merchant}`.toLowerCase();
        let bestCategory = 'Other';
        let bestScore = 0;

        for (const [category, config] of Object.entries(this.categories)) {
          let score = 0;
          for (const keyword of config.keywords) {
            if (text.includes(keyword.toLowerCase())) {
              score += config.weight;
            }
          }

          if (score > bestScore) {
            bestScore = score;
            bestCategory = category;
          }
        }

        return bestCategory;
      }

      // Detect transaction signals and anomalies
      detectSignals(desc, category) {
        const signals = [];

        // Check for recurring patterns
        const isRecurring = this.recurringPatterns.some(pattern => pattern.test(desc));
        if (isRecurring) {
          signals.push('Recurring Subscription');
        }

        // Check for unusual amounts (would need amount in real scenario)
        // For demo purposes, detect based on keywords
        if (/large|high|expensive/i.test(desc)) {
          signals.push('High Value');
        }

        // Category-specific signals
        if (category === 'Transport' && /international|airport/i.test(desc)) {
          signals.push('Travel Related');
        }

        if (category === 'Food' && /delivery|deliveroo|uber eats/i.test(desc)) {
          signals.push('Food Delivery');
        }

        return signals.length > 0 ? signals : ['Standard Transaction'];
      }

      // Calculate confidence score
      calculateConfidence(merchant, category, signals) {
        let confidence = 0.6; // Base confidence

        if (merchant && merchant.length > 3) confidence += 0.2;
        if (category !== 'Other') confidence += 0.15;
        if (signals.length > 1) confidence += 0.05;

        return Math.min(confidence, 0.95);
      }
    }

    // Rule-based extraction for comparison
    class RuleBasedExtractor {
      extract(desc) {
        // Simple regex-based extraction
        const merchant = desc
          .replace(/POS\s*\d+/gi, '')
          .replace(/\d+/g, '')
          .trim()
          .split(' ')
          .slice(0, 2)
          .join(' ');

        // Basic category matching
        let category = 'Unknown';
        if (/coffee|cafe|starbucks/i.test(desc)) category = 'Food';
        else if (/gas|fuel|shell/i.test(desc)) category = 'Transport';
        else if (/amazon|shop/i.test(desc)) category = 'Shopping';

        return {
          merchant: merchant || 'Unknown',
          category: category,
          confidence: '0.45'
        };
      }
    }

    // Initialize engines
    const aiEngine = new TransactionEnricher();
    const ruleEngine = new RuleBasedExtractor();

    // Render enrichment results
    function renderResults(aiResult, ruleResult) {
      const output = document.getElementById('output');
      
      let html = '<div class="card">';
      html += '<h3>AI-Powered Enrichment</h3>';
      html += '<div class="panel">';
      html += `<div class="grid">`;
      html += `<div class="col-6"><div class="small">Merchant</div><div><strong>${aiResult.merchant}</strong></div></div>`;
      html += `<div class="col-6"><div class="small">Category</div><div><strong>${aiResult.category}</strong></div></div>`;
      html += `<div class="col-12"><div class="small">Signals</div><div class="tags mt-4">`;
      aiResult.signals.forEach(signal => {
        html += `<span class="tag">${signal}</span>`;
      });
      html += `</div></div>`;
      html += `<div class="col-12"><div class="small">Confidence</div><div><strong>${(aiResult.confidence * 100).toFixed(0)}%</strong></div></div>`;
      html += `</div>`;
      html += '</div>';
      html += '</div>';

      // Show comparison if rule-based result available
      if (ruleResult) {
        html += '<div class="card mt-16">';
        html += '<h3>Rule-Based Extraction (for comparison)</h3>';
        html += '<div class="panel">';
        html += `<div class="grid">`;
        html += `<div class="col-4"><div class="small">Merchant</div><div>${ruleResult.merchant}</div></div>`;
        html += `<div class="col-4"><div class="small">Category</div><div>${ruleResult.category}</div></div>`;
        html += `<div class="col-4"><div class="small">Confidence</div><div>${(ruleResult.confidence * 100).toFixed(0)}%</div></div>`;
        html += `</div>`;
        html += '</div>';
        html += '<p class="small mt-8" style="color: var(--muted);">Note: Rule-based systems struggle with unseen merchants and multi-language noise.</p>';
        html += '</div>';
      }

      // Show cleaned version
      html += '<div class="card mt-16">';
      html += '<h3>Structured Output (JSON)</h3>';
      html += '<pre style="font-size: 12px; max-height: 300px; overflow: auto; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px;">';
      html += JSON.stringify(aiResult, null, 2);
      html += '</pre>';
      html += '</div>';

      output.innerHTML = html;
    }

    // Render batch comparison
    function renderBatchComparison(results) {
      const comparisonOutput = document.getElementById('comparison-output');
      
      let html = '<div class="grid">';
      
      results.forEach((result, idx) => {
        html += '<div class="col-6">';
        html += '<div class="card">';
        html += `<h4 class="small">Transaction ${idx + 1}</h4>`;
        html += `<p class="small" style="font-family: monospace; color: var(--muted);">${result.raw.substring(0, 40)}...</p>`;
        html += '<div class="grid mt-8">';
        html += '<div class="col-6">';
        html += '<div class="panel">';
        html += '<div class="small">AI Enrichment</div>';
        html += `<div><strong>${result.ai.merchant}</strong></div>`;
        html += `<div class="small">${result.ai.category}</div>`;
        html += '</div>';
        html += '</div>';
        html += '<div class="col-6">';
        html += '<div class="panel">';
        html += '<div class="small">Rule-Based</div>';
        html += `<div>${result.rule.merchant}</div>`;
        html += `<div class="small">${result.rule.category}</div>`;
        html += '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
      });
      
      html += '</div>';
      comparisonOutput.innerHTML = html;
    }

    // Event handlers
    document.getElementById('enrich-btn').addEventListener('click', () => {
      const input = document.getElementById('input-transaction').value.trim();
      
      if (!input) {
        document.getElementById('output').innerHTML = '<div class="card"><p>Please enter a transaction description.</p></div>';
        return;
      }

      const aiResult = aiEngine.enrich(input);
      const ruleResult = ruleEngine.extract(input);
      
      renderResults(aiResult, ruleResult);
    });

    document.getElementById('batch-btn').addEventListener('click', () => {
      const examples = [
        'POS 4839 STARBUCKS COFFEE MILANO 02/11 IT',
        'AMAZON EU SARL LUX 12345 ORDER',
        'ENEL ENERGIA SPA UTENZA 789012',
        'UBER TRIPFARE 4567 LONDON UK',
        'ATM WITHDRAWAL MILANO CENTRALE',
        'NETFLIX COM MONTHLY SUBSCRIPTION'
      ];

      const results = examples.map(ex => ({
        raw: ex,
        ai: aiEngine.enrich(ex),
        rule: ruleEngine.extract(ex)
      }));

      renderBatchComparison(results);
      
      // Also show first result in detail
      renderResults(results[0].ai, results[0].rule);
    });

    document.getElementById('clear-btn').addEventListener('click', () => {
      document.getElementById('input-transaction').value = '';
      document.getElementById('output').innerHTML = '';
      document.getElementById('comparison-output').innerHTML = '';
    });

    // Load initial example
    document.getElementById('enrich-btn').click();
  </script>

  <script src="/build-info.js"></script>
</body>
</html>

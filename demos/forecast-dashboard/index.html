<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tabular Forecast Dashboard | Neuromorphic Inference Lab</title>
  <meta name="description" content="Tabular forecasting demo: enter a time series, apply a simple forecast baseline, and inspect the output with a lightweight chart." />

  <style>
    :root{
      --bg: #070A12;
      --surface: rgba(255,255,255,.06);
      --surface2: rgba(255,255,255,.08);
      --border: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --accent: #64FFDA;
      --accent2: #7C5CFF;
      --danger: #FF4D6D;
      --ok: #43FBA4;
      --warn: #FFCE57;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --max: 1100px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(100,255,218,.14), transparent 55%),
        radial-gradient(700px 450px at 40% 80%, rgba(124,92,255,.12), transparent 60%),
        var(--bg);
      line-height: 1.55;
    }

    a{ color: inherit; text-decoration: none; }
    a:hover{ text-decoration: underline; text-underline-offset: 3px; }

    .wrap{ max-width: var(--max); margin: 0 auto; padding: 20px 18px 46px; }

    header{
      position: sticky; top: 0; z-index: 10;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(7,10,18,.82), rgba(7,10,18,.50));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .nav{
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }
    .brand{ display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: .2px; }
    .logo{
      width: 34px; height: 34px; border-radius: 10px;
      background:
        radial-gradient(circle at 30% 30%, rgba(100,255,218,.95), rgba(100,255,218,.15) 58%, transparent 60%),
        radial-gradient(circle at 70% 70%, rgba(124,92,255,.9), rgba(124,92,255,.18) 55%, transparent 57%),
        rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
    }
    nav ul{ list-style: none; display: flex; gap: 10px; padding: 0; margin: 0; flex-wrap: wrap; justify-content: flex-end; }
    .pill{
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted); font-size: 14px;
    }
    .pill.active{
      color: var(--text);
      border-color: rgba(100,255,218,.35);
      background: rgba(100,255,218,.08);
    }

    .hero{
      margin-top: 22px;
      padding: 22px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .hero:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(420px 260px at 10% 20%, rgba(100,255,218,.20), transparent 55%),
        radial-gradient(420px 260px at 90% 40%, rgba(124,92,255,.18), transparent 60%);
      pointer-events:none;
      filter: blur(1px);
    }
    .hero > *{ position: relative; }

    h1{ margin: 0 0 8px; font-size: clamp(28px, 4vw, 42px); line-height: 1.12; letter-spacing: .2px; }
    .subtitle{ margin: 0; color: var(--muted); max-width: 92ch; }

    .row{
      margin-top: 14px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .btn{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 600;
      font-size: 14px;
      line-height: 1.4;
      box-shadow: 0 10px 20px rgba(0,0,0,.18);
      cursor: pointer;
    }
    .btn:hover{ background: rgba(255,255,255,.08); text-decoration: none; }
    .btn.primary{
      border-color: rgba(100,255,218,.40);
      background: linear-gradient(135deg, rgba(100,255,218,.18), rgba(124,92,255,.12));
    }
    .btn.ghost{ background: transparent; border-color: rgba(255,255,255,.10); box-shadow: none; }

    .kbd{
      font-family: var(--mono);
      font-size: 12px;
      padding: 2px 8px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      border-radius: 999px;
      color: rgba(255,255,255,.78);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      font-size: 12px;
      color: rgba(255,255,255,.78);
      font-family: var(--mono);
      white-space: nowrap;
    }
    .badge.ok{ border-color: rgba(67,251,164,.35); background: rgba(67,251,164,.10); color: rgba(255,255,255,.90); }
    .badge.bad{ border-color: rgba(255,77,109,.35); background: rgba(255,77,109,.10); color: rgba(255,255,255,.90); }
    .badge.warn{ border-color: rgba(255,206,87,.30); background: rgba(255,206,87,.10); color: rgba(255,255,255,.90); }

    .grid{
      margin-top: 16px;
      display: grid;
      gap: 12px;
      grid-template-columns: 1.2fr 0.8fr;
      align-items: start;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
      padding: 16px;
    }
    .card h2{ margin: 0 0 8px; font-size: 18px; letter-spacing: .2px; }

    .muted{ color: var(--muted); }
    .small{ font-size: 14px; }
    .mono{ font-family: var(--mono); }

    .divider{ height: 1px; background: rgba(255,255,255,.08); margin: 14px 0; }

    .field{ display:flex; flex-direction: column; gap: 8px; margin-top: 10px; }
    textarea{
      width: 100%;
      min-height: 140px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: var(--text);
      padding: 12px 12px;
      font-family: var(--mono);
      font-size: 12.5px;
      outline: none;
    }
    textarea:focus{
      border-color: rgba(100,255,218,.35);
      box-shadow: 0 0 0 4px rgba(100,255,218,.08);
    }

    .controls{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 10px;
    }

    .inputRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 820px){ .inputRow{ grid-template-columns: 1fr; } }

    .input{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      padding: 10px 12px;
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    label{ font-size: 12px; color: rgba(255,255,255,.78); }
    input, select{
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.90);
      padding: 10px 10px;
      outline: none;
      font-family: var(--sans);
      font-size: 14px;
    }
    input:focus, select:focus{
      border-color: rgba(100,255,218,.35);
      box-shadow: 0 0 0 4px rgba(100,255,218,.08);
    }

    .output{
      margin-top: 12px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    .output h3{ margin: 0 0 10px 0; font-size: 16px; letter-spacing: .2px; }

    .chartWrap{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 10px;
      overflow: hidden;
    }
    svg{ width: 100%; height: 200px; display:block; }
    .legend{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 10px;
      color: rgba(255,255,255,.78);
      font-size: 12px;
      font-family: var(--mono);
    }
    .dot{
      width: 10px; height: 10px; border-radius: 999px;
      display:inline-block;
      border: 1px solid rgba(255,255,255,.15);
      margin-right: 6px;
    }
    .dot.a{ background: rgba(100,255,218,.85); }
    .dot.f{ background: rgba(124,92,255,.85); }

    pre{
      margin: 10px 0 0;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      overflow: auto;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.82);
    }

    footer{ margin-top: 24px; color: rgba(255,255,255,.55); font-size: 13px; }
  </style>
</head>

<body>
<header>
  <div class="nav">
    <a class="brand" href="/" aria-label="Neuromorphic Inference Lab Home">
      <span class="logo" aria-hidden="true"></span>
      <span>Neuromorphic Inference Lab</span>
    </a>
    <nav aria-label="Main navigation">
      <ul>
        <li><a class="pill" href="/">Home</a></li>
        <li><a class="pill active" href="/demos/">Demos</a></li>
        <li><a class="pill" href="/evidence/">Evidence</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Tabular Forecast Dashboard</h1>
    <p class="subtitle">
      A lightweight forecasting sandbox for a single time series. Enter values, choose a baseline method, and inspect the output.
      The interaction below runs locally in your browser; a live API can be added later.
    </p>

    <div class="row">
      <a class="btn primary" href="/demos/">Back to Demos</a>
      <a class="btn" href="/evidence/#forecast-dashboard">Evidence <span class="kbd">#forecast-dashboard</span></a>
      <a class="btn" href="https://api.neuromorphicinference.com/health" target="_blank" rel="noopener noreferrer">Live API <span class="kbd">/health</span></a>
      <a class="btn" href="https://api.neuromorphicinference.com/version" target="_blank" rel="noopener noreferrer">Build info <span class="kbd">/version</span></a>
    </div>
  </section>

  <section class="grid">
    <div class="card">
      <h2>Try it</h2>
      <p class="muted small">
        Paste a series (one number per line, or comma-separated). Choose a baseline forecast and generate the next steps.
      </p>

      <div class="field">
        <label for="series" class="small" style="color: rgba(255,255,255,.82); font-weight: 700;">Series</label>
        <textarea id="series" spellcheck="false">120
124
129
127
131
138
142
141
145
149
150
152</textarea>
      </div>

      <div class="inputRow">
        <div class="input">
          <label for="method">Method</label>
          <select id="method">
            <option value="naive">Naïve (last value)</option>
            <option value="sma" selected>Simple moving average</option>
            <option value="wma">Weighted moving average</option>
          </select>
        </div>

        <div class="input">
          <label for="window">Window (for averages)</label>
          <input id="window" type="number" min="2" max="50" value="4" />
        </div>

        <div class="input">
          <label for="horizon">Horizon (steps ahead)</label>
          <input id="horizon" type="number" min="1" max="24" value="6" />
        </div>
      </div>

      <div class="controls">
        <button class="btn primary" id="btnRun">Run forecast</button>
        <button class="btn" id="btnExample">Load example</button>
        <button class="btn" id="btnClear">Clear</button>
        <span class="badge" id="bState">state: idle</span>
        <span class="badge warn" id="bMode">mode: local</span>
      </div>

      <div class="output" id="out" style="display:none;">
        <h3>Result</h3>
        <div class="muted small mono" id="summary">—</div>

        <div class="divider"></div>

        <div class="chartWrap" aria-label="Forecast chart">
          <svg id="chart" viewBox="0 0 1000 200" preserveAspectRatio="none" role="img" aria-label="Line chart"></svg>
          <div class="legend">
            <span><span class="dot a"></span>actual</span>
            <span><span class="dot f"></span>forecast</span>
          </div>
        </div>

        <div class="divider"></div>
        <h3 style="margin:0 0 10px 0; font-size: 16px;">Forecast values</h3>
        <pre id="values"></pre>
      </div>

      <div class="output" id="errBox" style="display:none; border-color: rgba(255,77,109,.35); background: rgba(255,77,109,.08);">
        <h3 style="margin:0 0 8px 0;">Error</h3>
        <div class="small" id="errMsg" style="white-space: pre-wrap;"></div>
      </div>
    </div>

    <aside class="card">
      <h2>Notes</h2>
      <ul class="small" style="margin:10px 0 0; padding-left:18px; color: rgba(255,255,255,.82);">
        <li>These baselines are intentionally simple and transparent.</li>
        <li>Use them to sanity-check data before moving to a trained model.</li>
        <li>For tabular data, feature engineering and evaluation matter as much as the model choice.</li>
      </ul>

      <div class="divider"></div>

      <h2>Optional: live API</h2>
      <p class="muted small">
        If you later deploy a forecasting endpoint, you can toggle this on. When enabled, the page will attempt:
        <span class="mono">POST /forecast</span> with the parsed series.
      </p>

      <div class="controls" style="margin-top: 8px;">
        <label class="badge warn" style="cursor:pointer; user-select:none;">
          <input id="useApi" type="checkbox" style="margin-right:8px;" />
          use live API (optional)
        </label>
      </div>

      <pre>{
  "series": [120, 124, 129],
  "method": "sma",
  "window": 4,
  "horizon": 6
}</pre>

      <p class="muted small" style="margin-top: 10px;">
        If the endpoint is not available, the page will fall back to local mode automatically.
      </p>
    </aside>
  </section>

  <footer>
    <div>© 2025 Neuromorphic Inference Lab — Tabular Forecast Dashboard</div>
  </footer>
</main>

<script>
  const API_BASE = "https://api.neuromorphicinference.com";

  const els = {
    series: document.getElementById("series"),
    method: document.getElementById("method"),
    window: document.getElementById("window"),
    horizon: document.getElementById("horizon"),
    btnRun: document.getElementById("btnRun"),
z
  };

  // Fix accidental stray character if copied into editors that preserve it
</script>

<script>
  const API_BASE2 = "https://api.neuromorphicinference.com";

  const ui = {
    series: document.getElementById("series"),
    method: document.getElementById("method"),
    window: document.getElementById("window"),
    horizon: document.getElementById("horizon"),
    btnRun: document.getElementById("btnRun"),
    btnExample: document.getElementById("btnExample"),
    btnClear: document.getElementById("btnClear"),
    bState: document.getElementById("bState"),
    bMode: document.getElementById("bMode"),
    out: document.getElementById("out"),
    errBox: document.getElementById("errBox"),
    errMsg: document.getElementById("errMsg"),
    summary: document.getElementById("summary"),
    values: document.getElementById("values"),
    chart: document.getElementById("chart"),
    useApi: document.getElementById("useApi"),
  };

  function setBadge(el, text, state) {
    el.textContent = text;
    el.classList.remove("ok", "bad", "warn");
    if (state) el.classList.add(state);
  }

  function showError(msg) {
    ui.errMsg.textContent = msg;
    ui.errBox.style.display = "block";
  }

  function hideError() {
    ui.errMsg.textContent = "";
    ui.errBox.style.display = "none";
  }

  function showOutput() { ui.out.style.display = "block"; }
  function hideOutput() {
    ui.out.style.display = "none";
    ui.summary.textContent = "—";
    ui.values.textContent = "";
    ui.chart.innerHTML = "";
  }

  function parseSeries(text) {
    const cleaned = text
      .replace(/\r/g, "\n")
      .replace(/;/g, ",")
      .replace(/\t/g, ",")
      .trim();

    if (!cleaned) return [];

    const parts = cleaned.includes("\n")
      ? cleaned.split("\n")
      : cleaned.split(",");

    const nums = parts
      .map(s => s.trim())
      .filter(Boolean)
      .map(s => Number(s));

    if (nums.some(n => Number.isNaN(n))) {
      throw new Error("The series contains a value that is not a number.");
    }
    return nums;
  }

  function forecastLocal(series, method, window, horizon) {
    const out = [];
    const w = Math.max(2, Math.min(50, window | 0));
    const h = Math.max(1, Math.min(24, horizon | 0));

    let working = series.slice();

    for (let i = 0; i < h; i++) {
      let next = working[working.length - 1];

      if (method === "sma") {
        const slice = working.slice(-w);
        next = slice.reduce((a,b)=>a+b,0) / slice.length;
      } else if (method === "wma") {
        const slice = working.slice(-w);
        const weights = slice.map((_, idx) => idx + 1); // 1..w
        const denom = weights.reduce((a,b)=>a+b,0);
        const num = slice.reduce((acc, val, idx) => acc + val * weights[idx], 0);
        next = num / denom;
      } // naive uses last value

      out.push(next);
      working.push(next);
    }
    return out;
  }

  function formatNum(n) {
    const r = Math.round(n * 100) / 100;
    return Number.isInteger(r) ? String(r) : r.toFixed(2);
  }

  function drawChart(actual, forecast) {
    const all = actual.concat(forecast);
    const min = Math.min(...all);
    const max = Math.max(...all);
    const pad = (max - min) * 0.08 || 1;
    const lo = min - pad;
    const hi = max + pad;

    const W = 1000;
    const H = 200;

    const xStep = (W) / (all.length - 1 || 1);

    function xy(i, v){
      const x = i * xStep;
      const y = H - ((v - lo) / (hi - lo)) * H;
      return [x, y];
    }

    function pathFrom(values, offset=0){
      return values.map((v, i) => {
        const [x,y] = xy(i + offset, v);
        return `${i===0 ? "M" : "L"} ${x.toFixed(2)} ${y.toFixed(2)}`;
      }).join(" ");
    }

    const actualPath = pathFrom(actual, 0);
    const forecastPath = pathFrom(forecast, actual.length - 1); // starts from last actual point

    const lastActual = actual[actual.length - 1];
    const [lx, ly] = xy(actual.length - 1, lastActual);

    ui.chart.innerHTML = `
      <defs>
        <linearGradient id="gA" x1="0" x2="1" y1="0" y2="0">
          <stop offset="0" stop-color="rgba(100,255,218,.95)"/>
          <stop offset="1" stop-color="rgba(100,255,218,.55)"/>
        </linearGradient>
        <linearGradient id="gF" x1="0" x2="1" y1="0" y2="0">
          <stop offset="0" stop-color="rgba(124,92,255,.95)"/>
          <stop offset="1" stop-color="rgba(124,92,255,.55)"/>
        </linearGradient>
      </defs>

      <rect x="0" y="0" width="${W}" height="${H}" fill="rgba(0,0,0,.0)"/>

      <path d="${actualPath}" fill="none" stroke="url(#gA)" stroke-width="3.2" stroke-linecap="round"/>
      <circle cx="${lx.toFixed(2)}" cy="${ly.toFixed(2)}" r="4.5" fill="rgba(100,255,218,.95)"/>

      <path d="M ${lx.toFixed(2)} ${ly.toFixed(2)} ${forecastPath}" fill="none" stroke="url(#gF)" stroke-width="3.2" stroke-linecap="round" stroke-dasharray="7 6"/>
    `;
  }

  async function fetchWithTimeout(url, opts = {}, ms = 9000) {
    const ctrl = new AbortController();
    const t = setTimeout(() => ctrl.abort(), ms);
    try {
      const res = await fetch(url, {
        ...opts,
        signal: ctrl.signal,
        headers: {
          "Accept": "application/json",
          ...(opts.headers || {})
        }
      });
      clearTimeout(t);
      return res;
    } catch (e) {
      clearTimeout(t);
      throw e;
    }
  }

  async function tryApi(payload) {
    const r = await fetchWithTimeout(`${API_BASE2}/forecast`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    }, 9000);

    if (!r.ok) {
      const txt = await r.text().catch(() => "");
      throw new Error(`API returned HTTP ${r.status}${txt ? `: ${txt}` : ""}`);
    }
    return r.json();
  }

  async function run() {
    hideError();
    hideOutput();
    setBadge(ui.bState, "state: working…", "warn");

    try {
      const series = parseSeries(ui.series.value);
      if (series.length < 3) {
        throw new Error("Please provide at least 3 data points.");
      }

      const method = ui.method.value;
      const window = Number(ui.window.value);
      const horizon = Number(ui.horizon.value);

      const payload = { series, method, window, horizon };

      let forecast = null;
      let mode = "local";

      if (ui.useApi.checked) {
        try {
          const data = await tryApi(payload);
          forecast = Array.isArray(data?.forecast) ? data.forecast : null;
          if (!forecast) throw new Error("API response did not include a 'forecast' array.");
          mode = "api";
        } catch (e) {
          // fall back silently with a clear note in the UI
          forecast = forecastLocal(series, method, window, horizon);
          mode = "local (fallback)";
        }
      } else {
        forecast = forecastLocal(series, method, window, horizon);
      }

      const f = forecast.slice(0, Math.max(1, Math.min(24, horizon|0)));

      ui.summary.textContent =
        `series_len=${series.length} | method=${method} | window=${window} | horizon=${f.length} | mode=${mode}`;

      ui.values.textContent = f.map((v, i) => `t+${i+1}: ${formatNum(v)}`).join("\n");

      drawChart(series, [series[series.length - 1]].concat(f)); // connect visually from last actual

      setBadge(ui.bState, "state: done", "ok");
      setBadge(ui.bMode, `mode: ${mode}`, mode.startsWith("api") ? "ok" : "warn");

      showOutput();
    } catch (e) {
      showError(e?.message || String(e));
      setBadge(ui.bState, "state: error", "bad");
    }
  }

  ui.btnRun.addEventListener("click", run);

  ui.btnExample.addEventListener("click", () => {
    ui.series.value = [
      "120,124,129,127,131,138,142,141,145,149,150,152",
      "155,158,160,162,165,167,170"
    ].join("\n");
    ui.method.value = "sma";
    ui.window.value = "4";
    ui.horizon.value = "6";
    hideError();
    hideOutput();
    setBadge(ui.bState, "state: idle", null);
  });

  ui.btnClear.addEventListener("click", () => {
    ui.series.value = "";
    hideError();
    hideOutput();
    setBadge(ui.bState, "state: idle", null);
  });

  window.addEventListener("load", () => {
    setBadge(ui.bState, "state: idle", null);
  });
</script>
</body>
</html>

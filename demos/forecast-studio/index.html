<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forecast Studio | Neuromorphic Inference Lab</title>
  <meta name="description" content="Forecast Studio: paste a numeric series, run a local baseline forecast, visualise the result, and optionally call an API endpoint." />

  <style>
    :root{
      --bg:#070A12;--surface:rgba(255,255,255,.06);--border:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);--muted:rgba(255,255,255,.68);
      --accent:#64FFDA;--accent2:#7C5CFF;--ok:#43FBA4;--warn:#FFCE57;--danger:#FF4D6D;
      --shadow:0 10px 30px rgba(0,0,0,.35);--radius:18px;--max:1100px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;font-family:var(--sans);color:var(--text);line-height:1.55;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(100,255,218,.14), transparent 55%),
        radial-gradient(700px 450px at 40% 80%, rgba(124,92,255,.12), transparent 60%),
        var(--bg);
    }
    a{color:inherit;text-decoration:none;}
    a:hover{text-decoration:underline;text-underline-offset:3px;}
    .wrap{max-width:var(--max);margin:0 auto;padding:20px 18px 46px;}

    header{
      position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);
      background:linear-gradient(to bottom, rgba(7,10,18,.82), rgba(7,10,18,.50));
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .nav{max-width:var(--max);margin:0 auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:14px;}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.2px;}
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:
        radial-gradient(circle at 30% 30%, rgba(100,255,218,.95), rgba(100,255,218,.15) 58%, transparent 60%),
        radial-gradient(circle at 70% 70%, rgba(124,92,255,.9), rgba(124,92,255,.18) 55%, transparent 57%),
        rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 8px 22px rgba(0,0,0,.25);
    }
    nav ul{list-style:none;display:flex;gap:10px;padding:0;margin:0;flex-wrap:wrap;justify-content:flex-end;}
    .pill{
      display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);color:var(--muted);font-size:14px;
    }
    .pill.active{color:var(--text);border-color:rgba(100,255,218,.35);background:rgba(100,255,218,.08);}

    .hero{
      margin-top:22px;padding:22px;border-radius:var(--radius);border:1px solid var(--border);
      background:linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow:var(--shadow);position:relative;overflow:hidden;
    }
    .hero:before{
      content:"";position:absolute;inset:-2px;
      background:
        radial-gradient(420px 260px at 10% 20%, rgba(100,255,218,.20), transparent 55%),
        radial-gradient(420px 260px at 90% 40%, rgba(124,92,255,.18), transparent 60%);
      pointer-events:none;filter:blur(1px);
    }
    .hero>*{position:relative;}
    h1{margin:0 0 8px;font-size:clamp(28px,4vw,42px);line-height:1.12;letter-spacing:.2px;}
    .subtitle{margin:0;color:var(--muted);max-width:92ch;}

    .rowWrap{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .btn{
      display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);
      color:var(--text);font-weight:600;font-size:14px;box-shadow:0 10px 20px rgba(0,0,0,.18);cursor:pointer;
    }
    .btn:hover{background:rgba(255,255,255,.08);text-decoration:none;}
    .btn.primary{
      border-color:rgba(100,255,218,.40);
      background:linear-gradient(135deg, rgba(100,255,218,.18), rgba(124,92,255,.12));
    }
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.10);box-shadow:none;}
    .btn:disabled{opacity:.6;cursor:not-allowed;}

    .kbd{
      font-family:var(--mono);font-size:12px;padding:2px 8px;border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25);border-radius:999px;color:rgba(255,255,255,.78);
    }
    .badge{
      display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);
      font-size:12px;color:rgba(255,255,255,.78);font-family:var(--mono);white-space:nowrap;
    }
    .badge.ok{border-color:rgba(67,251,164,.35);background:rgba(67,251,164,.10);color:rgba(255,255,255,.90);}
    .badge.bad{border-color:rgba(255,77,109,.35);background:rgba(255,77,109,.10);color:rgba(255,255,255,.90);}
    .badge.warn{border-color:rgba(255,206,87,.30);background:rgba(255,206,87,.10);color:rgba(255,255,255,.90);}

    .grid{margin-top:16px;display:grid;gap:12px;grid-template-columns:1.25fr .75fr;align-items:start;}
    @media (max-width:980px){.grid{grid-template-columns:1fr;}}
    .card{border-radius:var(--radius);border:1px solid var(--border);background:rgba(255,255,255,.05);box-shadow:0 10px 24px rgba(0,0,0,.22);padding:16px;}
    .card h2{margin:0 0 8px;font-size:18px;letter-spacing:.2px;}
    .muted{color:var(--muted);}
    .small{font-size:14px;}
    .mono{font-family:var(--mono);}
    .divider{height:1px;background:rgba(255,255,255,.08);margin:14px 0;}

    .toggle{
      display:inline-flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);padding:6px;border-radius:999px;
    }
    .toggle button{
      border:0;background:transparent;color:rgba(255,255,255,.75);
      padding:8px 10px;border-radius:999px;cursor:pointer;font-weight:700;font-size:12px;
    }
    .toggle button.active{
      color:rgba(255,255,255,.92);
      background:linear-gradient(135deg, rgba(100,255,218,.16), rgba(124,92,255,.12));
      border:1px solid rgba(100,255,218,.30);
    }

    textarea{
      width:100%;min-height:120px;resize:vertical;
      border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);color:var(--text);
      padding:12px 12px;font-family:var(--mono);outline:none;
    }
    textarea:focus{
      border-color:rgba(100,255,218,.35);
      box-shadow:0 0 0 4px rgba(100,255,218,.08);
    }

    .row2{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px;}
    .field{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      border-radius:14px;
      padding:12px;
      flex:1;
      min-width:220px;
    }
    label{display:flex;justify-content:space-between;gap:10px;align-items:baseline;font-weight:800;font-size:13px;color:rgba(255,255,255,.84);}
    .hint{font-weight:600;color:rgba(255,255,255,.55);font-size:12px;}
    input[type="number"], select{
      width:100%;
      margin-top:8px;
      border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);color:var(--text);
      padding:10px 10px;font-family:var(--mono);outline:none;
    }
    select:focus, input[type="number"]:focus{
      border-color:rgba(100,255,218,.35);
      box-shadow:0 0 0 4px rgba(100,255,218,.08);
    }

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);font-size:12px;color:rgba(255,255,255,.82);
      cursor:pointer;user-select:none;
    }
    .chip:hover{background:rgba(255,255,255,.06);}

    .plot{
      margin-top:12px;
      border-radius:14px;border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      overflow:hidden;
      padding:10px;
    }
    canvas{width:100%;height:260px;display:block;}

    pre{
      margin:10px 0 0;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.25);overflow:auto;font-family:var(--mono);font-size:12px;color:rgba(255,255,255,.82);
    }
    footer{margin-top:24px;color:rgba(255,255,255,.55);font-size:13px;}
  </style>
</head>

<body>
<header>
  <div class="nav">
    <a class="brand" href="/" aria-label="Neuromorphic Inference Lab Home">
      <span class="logo" aria-hidden="true"></span>
      <span>Neuromorphic Inference Lab</span>
    </a>
    <nav aria-label="Main navigation">
      <ul>
        <li><a class="pill" href="/">Home</a></li>
        <li><a class="pill active" href="/demos/">Demos</a></li>
        <li><a class="pill" href="/evidence/">Evidence</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Forecast Studio</h1>
    <p class="subtitle">
      Paste a numeric series and run a local baseline forecast. The plot shows history and forecast in one view.
      API mode expects <span class="mono">POST /forecast/predict</span> (optional).
    </p>

    <div class="rowWrap">
      <a class="btn primary" href="/evidence/#forecast-studio">Evidence anchor <span class="kbd">#forecast-studio</span></a>
      <a class="btn" href="https://github.com/nepryoon/nil-forecast-studio" target="_blank" rel="noopener noreferrer">GitHub</a>

      <span class="toggle" role="group" aria-label="Mode selector">
        <button id="modeLocal" class="active" type="button">Local</button>
        <button id="modeApi" type="button">API</button>
      </span>

      <span class="badge warn" id="bMode">mode: local</span>
      <span class="badge" id="bStatus">status: idle</span>
      <span class="badge" id="bSummary">summary: —</span>
    </div>
  </section>

  <section class="grid">
    <div class="card">
      <h2>Series</h2>
      <p class="muted small">
        Provide values separated by commas, spaces, or new lines. Local mode uses deterministic baselines (naïve or moving average).
      </p>

      <div class="chips" aria-label="Sample series">
        <span class="chip" data-sample="trend">Sample: trend</span>
        <span class="chip" data-sample="seasonal">Sample: seasonal</span>
        <span class="chip" data-sample="noisy">Sample: noisy</span>
      </div>

      <textarea id="series" spellcheck="false" placeholder="e.g. 12, 13, 14, 15, 14, 16, 18"></textarea>

      <div class="row2">
        <div class="field">
          <label for="horizon">Horizon <span class="hint">steps</span></label>
          <input id="horizon" type="number" min="1" max="60" step="1" value="12" />
        </div>
        <div class="field">
          <label for="method">Method <span class="hint">baseline</span></label>
          <select id="method">
            <option value="naive">Naïve (last value)</option>
            <option value="ma">Moving average (window=5)</option>
          </select>
        </div>
      </div>

      <div class="row2" style="margin-top:12px;">
        <button class="btn primary" id="btnRun" type="button">Forecast</button>
        <button class="btn" id="btnClear" type="button">Reset</button>
      </div>

      <div class="plot" aria-label="Forecast plot">
        <canvas id="cv" width="900" height="320"></canvas>
      </div>

      <div class="divider"></div>

      <h2>Output</h2>
      <pre id="out">{}</pre>
    </div>

    <aside class="card">
      <h2>Links</h2>
      <div class="small" style="display:grid;gap:10px;">
        <a class="btn" style="justify-content:space-between;" href="/evidence/#forecast-studio"><span>Evidence</span><span class="kbd">#forecast-studio</span></a>
        <a class="btn" style="justify-content:space-between;" href="/evidence/#ml"><span>Related</span><span class="kbd">#ml</span></a>
        <a class="btn" style="justify-content:space-between;" href="/evidence/#sql"><span>Related</span><span class="kbd">#sql</span></a>
        <a class="btn" style="justify-content:space-between;" href="https://github.com/nepryoon/nil-forecast-studio" target="_blank" rel="noopener noreferrer"><span>Repository</span><span class="kbd">GitHub</span></a>
      </div>

      <div class="divider"></div>

      <h2>API shape (optional)</h2>
      <pre>{
  "series": [12, 13, 14, 15],
  "horizon": 12,
  "method": "naive|ma"
}</pre>

      <div class="divider"></div>

      <h2>Notes</h2>
      <ul class="muted small" style="margin:0;padding-left:18px;line-height:1.7;">
        <li>Local mode is designed to be predictable and quick to inspect.</li>
        <li>API mode can swap in a stronger model when deployed.</li>
        <li>The plot separates history and forecast with a boundary marker.</li>
      </ul>
    </aside>
  </section>

  <footer>© <span id="year"></span> Neuromorphic Inference Lab — Forecast Studio</footer>
</main>

<script>
  const API_BASE = "https://api.neuromorphicinference.com";

  const el = {
    year: document.getElementById("year"),
    series: document.getElementById("series"),
    horizon: document.getElementById("horizon"),
    method: document.getElementById("method"),
    btnRun: document.getElementById("btnRun"),
    btnClear: document.getElementById("btnClear"),
    modeLocal: document.getElementById("modeLocal"),
    modeApi: document.getElementById("modeApi"),
    bMode: document.getElementById("bMode"),
    bStatus: document.getElementById("bStatus"),
    bSummary: document.getElementById("bSummary"),
    out: document.getElementById("out"),
    cv: document.getElementById("cv"),
  };

  el.year.textContent = new Date().getFullYear();

  let mode = "local";

  function setMode(next) {
    mode = next;
    el.modeLocal.classList.toggle("active", mode === "local");
    el.modeApi.classList.toggle("active", mode === "api");
    el.bMode.textContent = `mode: ${mode}`;
    el.bMode.classList.remove("ok","bad","warn");
    el.bMode.classList.add("warn");
  }

  function setStatus(text, state) {
    el.bStatus.textContent = text;
    el.bStatus.classList.remove("ok","bad","warn");
    if (state) el.bStatus.classList.add(state);
  }

  function setSummary(text, state) {
    el.bSummary.textContent = text;
    el.bSummary.classList.remove("ok","bad","warn");
    if (state) el.bSummary.classList.add(state);
  }

  function parseSeries(text) {
    const raw = (text || "").trim();
    if (!raw) throw new Error("Please paste a series first.");

    const parts = raw
      .split(/[\s,;]+/g)
      .map(s => s.trim())
      .filter(Boolean);

    const xs = parts.map(p => Number(p));
    if (!xs.length) throw new Error("Series is empty.");
    if (xs.some(v => !Number.isFinite(v))) throw new Error("Series contains non-numeric values.");
    if (xs.length < 4) throw new Error("Please provide at least 4 values.");
    return xs;
  }

  function mean(arr){ return arr.reduce((a,b)=>a+b,0)/arr.length; }
  function stdev(arr){
    const m = mean(arr);
    const v = mean(arr.map(x => (x-m)*(x-m)));
    return Math.sqrt(v);
  }

  function naiveForecast(series, horizon) {
    const last = series[series.length - 1];
    return Array.from({ length: horizon }, () => last);
  }

  function movingAverageForecast(series, horizon, windowSize = 5) {
    const out = [];
    let work = series.slice();
    for (let i = 0; i < horizon; i++) {
      const w = work.slice(Math.max(0, work.length - windowSize));
      const y = mean(w);
      out.push(y);
      work.push(y);
    }
    return out;
  }

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function drawPlot(history, forecast) {
    const canvas = el.cv;
    const ctx = canvas.getContext("2d");
    const W = canvas.width, H = canvas.height;

    const pad = 28;
    const all = history.concat(forecast);
    const minY = Math.min(...all);
    const maxY = Math.max(...all);
    const span = (maxY - minY) || 1;

    const nH = history.length;
    const nF = forecast.length;
    const n = nH + nF;

    function xAt(i){
      if (n <= 1) return pad;
      return pad + (i * (W - pad*2)) / (n - 1);
    }
    function yAt(v){
      const t = (v - minY) / span;
      return (H - pad) - t * (H - pad*2);
    }

    // Background
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = "rgba(0,0,0,.12)";
    ctx.fillRect(0, 0, W, H);

    // Grid
    ctx.strokeStyle = "rgba(255,255,255,.08)";
    ctx.lineWidth = 1;
    ctx.beginPath();
    for (let k = 0; k <= 4; k++) {
      const y = pad + k * (H - pad*2) / 4;
      ctx.moveTo(pad, y);
      ctx.lineTo(W - pad, y);
    }
    ctx.stroke();

    // Labels
    ctx.fillStyle = "rgba(255,255,255,.62)";
    ctx.font = "12px " + getComputedStyle(document.documentElement).getPropertyValue("--mono").trim();
    ctx.fillText(`min=${minY.toFixed(2)}`, pad, H - 10);
    ctx.fillText(`max=${maxY.toFixed(2)}`, pad, 18);

    // Boundary (history → forecast)
    const boundaryX = xAt(nH - 1);
    ctx.strokeStyle = "rgba(255,255,255,.12)";
    ctx.beginPath();
    ctx.moveTo(boundaryX, pad);
    ctx.lineTo(boundaryX, H - pad);
    ctx.stroke();

    // History line
    ctx.strokeStyle = "rgba(100,255,218,.95)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    history.forEach((v, i) => {
      const x = xAt(i);
      const y = yAt(v);
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();

    // Forecast line (dashed)
    ctx.strokeStyle = "rgba(124,92,255,.95)";
    ctx.setLineDash([6, 5]);
    ctx.lineWidth = 2;
    ctx.beginPath();
    forecast.forEach((v, j) => {
      const i = (nH - 1) + j;
      const x = xAt(i);
      const y = yAt(v);
      if (j === 0) {
        const x0 = xAt(nH - 1);
        const y0 = yAt(history[nH - 1]);
        ctx.moveTo(x0, y0);
        ctx.lineTo(x, y);
      } else {
        ctx.lineTo(x, y);
      }
    });
    ctx.stroke();
    ctx.setLineDash([]);

    // Legend
    ctx.fillStyle = "rgba(255,255,255,.78)";
    ctx.fillText("history", W - pad - 150, 18);
    ctx.fillText("forecast", W - pad - 70, 18);

    ctx.strokeStyle = "rgba(100,255,218,.95)";
    ctx.beginPath(); ctx.moveTo(W - pad - 180, 14); ctx.lineTo(W - pad - 158, 14); ctx.stroke();

    ctx.strokeStyle = "rgba(124,92,255,.95)";
    ctx.setLineDash([6,5]);
    ctx.beginPath(); ctx.moveTo(W - pad - 96, 14); ctx.lineTo(W - pad - 74, 14); ctx.stroke();
    ctx.setLineDash([]);
  }

  async function fetchWithTimeout(url, opts = {}, ms = 12000) {
    const ctrl = new AbortController();
    const t = setTimeout(() => ctrl.abort(), ms);
    try {
      const res = await fetch(url, {
        ...opts,
        signal: ctrl.signal,
        headers: { "Accept":"application/json", ...(opts.headers || {}) }
      });
      clearTimeout(t);
      return res;
    } catch (e) {
      clearTimeout(t);
      throw e;
    }
  }

  function normaliseMethod(m) {
    return (m === "ma") ? "ma" : "naive";
  }

  function extractForecastFromApi(data) {
    const candidates = [
      data?.forecast,
      data?.yhat,
      data?.prediction,
      data?.predictions
    ];
    for (const c of candidates) {
      if (Array.isArray(c) && c.length && c.every(v => Number.isFinite(Number(v)))) {
        return c.map(Number);
      }
    }
    return null;
  }

  async function run() {
    setStatus("status: running…", "warn");
    setSummary("summary: —", null);
    el.btnRun.disabled = true;

    try {
      const xs = parseSeries(el.series.value);
      const horizon = Number(el.horizon.value);
      if (!Number.isFinite(horizon) || horizon < 1 || horizon > 60) {
        throw new Error("Horizon must be between 1 and 60.");
      }

      const method = normaliseMethod(el.method.value);
      const t0 = performance.now();

      let forecast = [];
      let result = {};

      if (mode === "local") {
        forecast = (method === "ma")
          ? movingAverageForecast(xs, horizon, 5)
          : naiveForecast(xs, horizon);

        const t1 = performance.now();

        const m = mean(xs);
        const s = stdev(xs);

        result = {
          mode: "local",
          input: { series: xs, horizon, method },
          output: { forecast: forecast.map(v => Number(v.toFixed(6))) },
          diagnostics: {
            n: xs.length,
            mean: Number(m.toFixed(6)),
            stdev: Number(s.toFixed(6)),
            last: Number(xs[xs.length - 1].toFixed(6))
          },
          latency_ms: Math.round(t1 - t0)
        };

        setStatus("status: done", "ok");
        setSummary(`summary: n=${xs.length} | h=${horizon} | ${method}`, "ok");
      } else {
        const payload = { series: xs, horizon, method };

        const r = await fetchWithTimeout(`${API_BASE}/forecast/predict`, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        const text = await r.text();
        const data = (() => { try { return JSON.parse(text); } catch { return { raw: text }; } })();
        if (!r.ok) throw new Error(`API error (HTTP ${r.status}): ${data?.detail || text}`);

        const t1 = performance.now();

        const extracted = extractForecastFromApi(data);
        forecast = extracted || [];

        result = {
          mode: "api",
          input: payload,
          response: data,
          extracted_forecast: extracted ? extracted.map(v => Number(v.toFixed(6))) : null,
          latency_ms: Math.round(t1 - t0)
        };

        setStatus("status: done", "ok");
        setSummary(`summary: n=${xs.length} | h=${horizon} | api`, "ok");
      }

      if (forecast.length) drawPlot(xs, forecast);
      else drawPlot(xs, naiveForecast(xs, Math.min(6, horizon)));

      el.out.textContent = JSON.stringify(result, null, 2);
    } catch (e) {
      setStatus("status: error", "bad");
      setSummary("summary: error", "bad");
      el.out.textContent = JSON.stringify({ error: String(e?.message || e) }, null, 2);

      // Attempt to keep the canvas in a sane state.
      try {
        const xs = (el.series.value || "").trim() ? parseSeries(el.series.value) : [1,2,3,4,5,6];
        drawPlot(xs, naiveForecast(xs, 6));
      } catch {
        const ctx = el.cv.getContext("2d");
        ctx.clearRect(0,0,el.cv.width,el.cv.height);
      }
    } finally {
      el.btnRun.disabled = false;
    }
  }

  function resetDefaults() {
    el.series.value = "12, 13, 14, 15, 14, 16, 18, 19, 20, 22, 21, 23, 25, 26";
    el.horizon.value = "12";
    el.method.value = "naive";
    el.out.textContent = "{}";
    setStatus("status: idle", null);
    setSummary("summary: —", null);

    const xs = parseSeries(el.series.value);
    drawPlot(xs, naiveForecast(xs, 12));
  }

  function setSample(kind) {
    if (kind === "trend") {
      el.series.value = "10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24";
    } else if (kind === "seasonal") {
      el.series.value = "20, 23, 26, 24, 21, 19, 18, 20, 23, 26, 24, 21, 19, 18, 20";
    } else if (kind === "noisy") {
      el.series.value = "15, 14, 16, 13, 17, 16, 14, 18, 15, 19, 16, 17, 15, 18, 16";
    }
    setStatus("status: sample loaded", null);
  }

  document.querySelectorAll(".chip").forEach(ch => {
    ch.addEventListener("click", () => setSample(ch.getAttribute("data-sample")));
  });

  el.modeLocal.addEventListener("click", () => setMode("local"));
  el.modeApi.addEventListener("click", () => setMode("api"));

  el.btnRun.addEventListener("click", run);
  el.btnClear.addEventListener("click", resetDefaults);

  window.addEventListener("load", () => {
    resetDefaults();
    setTimeout(() => setSummary("summary: ready", null), 120);
  });
</script>
</body>
</html>

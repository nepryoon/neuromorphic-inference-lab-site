<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NeuroGrid Fault Risk Scoring Platform — Systems</title>
  <meta name="description" content="End-to-end ML system: feature engineering, MLflow training, CI/CD for ML, artefact versioning, FastAPI serving, and monitoring-ready outputs." />
  <link rel="icon" href="/favicon.svg" />
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <header class="nav">
    <div class="inner">
      <div class="brand">
        <img src="/logo.svg" alt="Neuromorphic Inference Lab" />
        <span>Neuromorphic Inference Lab</span>
      </div>
      <nav class="navlinks" aria-label="Primary navigation">
        <a data-nav href="/">Signal</a>
        <a data-nav class="active" href="/demos/">Systems</a>
        <a data-nav href="/evidence/">Proof Ledger</a>
        <a data-nav href="/about/">Identity</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <p class="kicker">Hero System</p>
      <h1 class="h1">NeuroGrid Fault Risk Scoring Platform</h1>
      <p class="sub">
        A production-first ML system that predicts medium-voltage fault risk to prioritise preventive interventions.
        Demonstrates the full delivery loop: ingestion → feature engineering → training (MLflow) → artefact versioning → Dockerised serving (FastAPI) → live inference.
      </p>

      <div class="actions">
        <a class="btn primary" href="/evidence/mv-grid-fault-risk/">Open evidence dossier</a>
        <a class="btn" href="https://mv-grid-fault-risk-api.onrender.com/docs" target="_blank" rel="noopener">Live API docs</a>
        <a class="btn" href="https://github.com/nepryoon/mv-grid-fault-risk" target="_blank" rel="noopener">Source</a>
      </div>

      <div class="badges">
        <span class="badge">CI/CD for ML</span>
        <span class="badge">Inference Serving</span>
        <span class="badge">Artefact Promotion</span>
        <span class="badge">Feature Engineering</span>
        <span class="badge">MLflow Tracking</span>
        <span class="badge">Monitoring-ready outputs</span>
      </div>
    </section>

    <section class="section">
      <div class="grid">
        <article class="card project col-6">
          <h3>Problem → impact</h3>
          <p>
            Grid operations need a consistent way to rank assets/feeders by fault risk and allocate preventive interventions.
            A risk score supports earlier dispatch decisions and reduces exposure to unplanned outages.
          </p>

          <h3>Proof links</h3>
          <p>Verification paths (code + CI + release artefact + live endpoint).</p>

          <div class="actions">
            <a class="btn primary" href="/evidence/mv-grid-fault-risk/">Evidence dossier</a>
            <a class="btn" href="https://github.com/nepryoon/mv-grid-fault-risk/actions" target="_blank" rel="noopener">CI training runs</a>
            <a class="btn" href="https://github.com/nepryoon/mv-grid-fault-risk/releases/tag/model-v0.1.0" target="_blank" rel="noopener">Model artefact</a>
            <a class="btn" href="/api/mvgrid/health" target="_blank" rel="noopener">Proxy health</a>
          </div>

          <div class="tags mt-12">
            <span class="tag">Time-aware split</span>
            <span class="tag">Reproducible builds</span>
            <span class="tag">Deployment-ready artefacts</span>
          </div>
        </article>

        <article class="card project col-6">
          <h3>Live inference demo</h3>
          <p>
            Score risk via a same-origin Cloudflare proxy (no CORS). If the upstream service was idle, the first request may take a moment to warm up.
          </p>

          <div class="card project p-16">
            <form id="score-form">
              <div class="grid">
                <div class="col-6">
                  <label><span>Asset age (years)</span>
                    <input name="asset_age_years" type="number" step="0.5" value="15" />
                  </label>
                </div>
                <div class="col-6">
                  <label><span>Days since last fault</span>
                    <input name="days_since_last_fault" type="number" step="1" value="365" />
                  </label>
                </div>

                <div class="col-4">
                  <label><span>Faults last 30 days</span>
                    <input name="faults_last_30d" type="number" step="1" value="0" />
                  </label>
                </div>
                <div class="col-4">
                  <label><span>Faults last 90 days</span>
                    <input name="faults_last_90d" type="number" step="1" value="1" />
                  </label>
                </div>
                <div class="col-4">
                  <label><span>Faults last 180 days</span>
                    <input name="faults_last_180d" type="number" step="1" value="2" />
                  </label>
                </div>

                <div class="col-6">
                  <label><span>Asset type</span>
                    <select name="asset_type">
                      <option value="overhead" selected>overhead</option>
                      <option value="underground">underground</option>
                      <option value="substation">substation</option>
                      <option value="unknown">unknown</option>
                    </select>
                  </label>
                </div>

                <div class="col-6">
                  <label><span>Region</span>
                    <select name="region">
                      <option value="north" selected>north</option>
                      <option value="centre">centre</option>
                      <option value="south">south</option>
                      <option value="unknown">unknown</option>
                    </select>
                  </label>
                </div>

                <div class="col-6">
                  <label><span>Voltage (kV)</span>
                    <input name="voltage_kv" type="number" step="1" value="15" />
                  </label>
                </div>

                <div class="col-6">
                  <label><span>Manufacturer</span>
                    <input name="manufacturer" type="text" value="GenericGridCo" />
                  </label>
                </div>

                <div class="col-12 mt-6">
                  <button class="btn primary" type="submit">Score risk</button>
                  <a class="btn" href="https://mv-grid-fault-risk-api.onrender.com/docs" target="_blank" rel="noopener">Open Swagger</a>
                </div>
              </div>
            </form>

            <div id="result" class="mt-14 muted"></div>
          </div>
        </article>
      </div>
    </section>

    <footer class="footer">
      <div>© <span id="year"></span> Neuromorphic Inference Lab</div>
      <div class="prov">
        <span id="build-branch">branch: …</span>
        <span id="build-commit">commit: …</span>
        <span id="build-time">built: …</span>
      </div>
    </footer>
  </main>

  <script>
    document.getElementById("year").textContent = String(new Date().getFullYear());

    const API_PREDICT = "/api/mvgrid/predict";
    const API_HEALTH  = "/api/mvgrid/health";

    function toNumber(v) {
      const n = Number(v);
      return Number.isFinite(n) ? n : v;
    }

    function pillRow(items) {
      return `<div class="prov">${items.map(x => `<span>${x}</span>`).join("")}</div>`;
    }

    document.getElementById("score-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);

      const features = {};
      for (const [k, v] of data.entries()) {
        const vv = (typeof v === "string") ? v.trim() : v;
        features[k] = vv === "" ? null : toNumber(vv);
      }

      const resultEl = document.getElementById("result");
      resultEl.textContent = "Scoring… (If the service was idle, it may take a moment to warm up.)";

      try { await fetch(API_HEALTH, { cache: "no-store" }); } catch (_) {}

      try {
        const res = await fetch(API_PREDICT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ features })
        });

        const txt = await res.text();
        if (!res.ok) throw new Error(`API error (${res.status}): ${txt}`);

        const out = JSON.parse(txt);
        const prob = Number(out.fault_probability_30d);
        const band = String(out.risk_band || "unknown").toUpperCase();
        const model = String(out.model_source || "model");

        resultEl.innerHTML =
          pillRow([
            `fault probability (30d): <strong>${Number.isFinite(prob) ? prob.toFixed(3) : out.fault_probability_30d}</strong>`,
            `risk band: <strong>${band}</strong>`,
            `model: ${model}`
          ]) + `<div class="mt-10"><small>Live inference via Cloudflare proxy → Render FastAPI → versioned model artefact.</small></div>`;

      } catch (err) {
        resultEl.textContent = "Request failed: " + err.message;
      }
    });
  </script>

  <script src="/build-info.js"></script>
</body>
</html>

<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tabular Risk — Projects</title>
  <meta name="description" content="Tabular Risk: enter a small feature set, score locally with a transparent baseline, and optionally call a deployed API endpoint." />
  <link rel="icon" href="/favicon.svg" />
  <link rel="stylesheet" href="/style.css" />

  <style>
    /* ── Demo-specific extensions only ── */
    .toggle {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding: 5px;
      border-radius: 999px;
    }
    .toggle button {
      border: 0;
      background: transparent;
      color: rgba(255,255,255,.65);
      padding: 6px 14px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
    }
    .toggle button.active {
      color: rgba(255,255,255,.92);
      background: linear-gradient(135deg, rgba(100,255,218,.16), rgba(124,92,255,.12));
      border: 1px solid rgba(100,255,218,.30);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      font-size: 12px;
      font-family: ui-monospace, monospace;
      color: rgba(255,255,255,.78);
      white-space: nowrap;
    }
    .status-badge.ok   { border-color: rgba(67,251,164,.35);  background: rgba(67,251,164,.10); }
    .status-badge.bad  { border-color: rgba(255,77,109,.35);  background: rgba(255,77,109,.10); }
    .status-badge.warn { border-color: rgba(255,206,87,.30);  background: rgba(255,206,87,.10); }

    .demo-grid {
      display: grid;
      gap: 16px;
      grid-template-columns: 1.3fr 0.7fr;
      align-items: start;
    }
    @media (max-width: 900px) { .demo-grid { grid-template-columns: 1fr; } }

    .feature-form {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr 1fr;
      margin-top: 12px;
    }
    @media (max-width: 700px) { .feature-form { grid-template-columns: 1fr; } }

    .field {
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      padding: 12px;
    }
    .field label {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: baseline;
      font-weight: 700;
      font-size: 13px;
      color: rgba(255,255,255,.84);
    }
    .field .hint { font-weight: 600; color: rgba(255,255,255,.50); font-size: 12px; }
    .field input[type="number"] {
      width: 100%;
      margin-top: 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.92);
      padding: 8px 10px;
      font-family: ui-monospace, monospace;
      font-size: 13px;
      outline: none;
    }
    .field input[type="number"]:focus {
      border-color: rgba(100,255,218,.35);
      box-shadow: 0 0 0 3px rgba(100,255,218,.08);
    }
    .field input[type="range"] {
      width: 100%;
      margin-top: 6px;
      accent-color: #64FFDA;
    }

    .chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size: 12px;
      color: rgba(255,255,255,.82);
      cursor: pointer;
      user-select: none;
    }
    .chip:hover { background: rgba(255,255,255,.07); }

    .risk-bar {
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      overflow: hidden;
      margin-top: 14px;
    }
    .risk-bar > div {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(67,251,164,.95), rgba(255,206,87,.95), rgba(255,77,109,.95));
      transition: width .35s ease;
    }

    .output-pre {
      margin: 12px 0 0;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      overflow: auto;
      font-family: ui-monospace, monospace;
      font-size: 12px;
      color: rgba(255,255,255,.82);
    }

    .error-box {
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,77,109,.35);
      background: rgba(255,77,109,.08);
      font-size: 13px;
      display: none;
    }

    .kbd {
      font-family: ui-monospace, monospace;
      font-size: 11px;
      padding: 2px 7px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      border-radius: 999px;
      color: rgba(255,255,255,.75);
    }

    .side-link {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-size: 13px;
      color: rgba(255,255,255,.82);
      text-decoration: none;
      margin-bottom: 8px;
    }
    .side-link:hover { background: rgba(255,255,255,.07); text-decoration: none; }

    .divider { height: 1px; background: rgba(255,255,255,.08); margin: 14px 0; }
  </style>
</head>

<body>
  <header class="nav">
    <div class="inner">
      <div class="brand">
        <img src="/logo.svg" alt="Neuromorphic Inference Lab" />
        <span>Neuromorphic Inference Lab</span>
      </div>
      <nav class="navlinks" aria-label="Primary navigation">
        <a data-nav href="/">Home</a>
        <a data-nav class="active" href="/demos/">Projects</a>
        <a data-nav href="/about/">About Me</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <p class="kicker">Project</p>
      <h1 class="h1">Tabular Risk</h1>
      <p class="sub">
        Client-side risk scoring system demonstrating transparent machine learning
        with interpretable logistic regression and optional API integration.
      </p>

      <div class="badges">
        <span class="badge">Client-Side ML</span>
        <span class="badge">Risk Scoring</span>
        <span class="badge">Transparent Baseline</span>
      </div>

      <div style="height:14px"></div>

      <div class="actions" style="flex-wrap:wrap; gap:10px; align-items:center;">
        <a class="btn" href="https://github.com/nepryoon/nil-tabular-risk" target="_blank" rel="noopener">Source</a>
        <a class="btn" href="/demos/">Back to Projects</a>
      </div>
    </section>

    <!-- Layer 1: Plain-language explanation -->
    <section class="section">
      <div class="card">
        <h2>What This Does</h2>
        <p>
          This is a risk scoring tool that runs entirely in your browser. You enter basic financial data 
          (age, income, debt ratio, late payments), and it calculates a risk score from 0-100%. 
          The calculation happens on your device—no data is sent anywhere unless you explicitly choose to test 
          the optional API mode.
        </p>
        
        <p>
          It solves the problem of opaque risk assessment by using a simple, transparent mathematical model 
          where you can see exactly how each input affects the final score. This is the opposite of a black-box 
          machine learning system where the decision logic is hidden.
        </p>

        <p>
          This project demonstrates three key capabilities: building interpretable machine learning models 
          that humans can audit, implementing complex calculations efficiently in client-side JavaScript, 
          and designing flexible systems that work both standalone and as API integrations.
        </p>
      </div>
    </section>

    <!-- Layer 2: Technical deep-dive -->
    <section class="section">
      <div class="card">
        <h2>Technical Overview</h2>
        
        <h3>Purpose and Scope</h3>
        <p>
          This system implements a client-side risk scoring engine for tabular financial data. 
          The primary goal is demonstrating interpretable machine learning through a transparent baseline model, 
          contrasted with an optional API integration path for more sophisticated models. 
          The scope is deliberately limited to a four-feature input space to maintain clarity and auditability.
        </p>

        <h3>Architecture and Design Decisions</h3>
        <p>
          The architecture is a single-page application with zero dependencies. Local scoring uses a 
          logistic regression model with hand-tuned weights (not trained on data), chosen specifically for 
          interpretability. Each feature contribution to the final risk score is exposed in the output, 
          allowing complete transparency into the decision process. The API mode provides a comparison point, 
          demonstrating how the same interface can work with either a simple baseline or a deployed model endpoint.
        </p>

        <h3>Data Flow and Execution Model</h3>
        <p>
          In local mode: User inputs are read from form fields, validated, normalized to [0,1] ranges, 
          multiplied by fixed weights, summed with a bias term, passed through a sigmoid activation function, 
          and rendered as both a visual progress bar and structured JSON output. The entire pipeline executes 
          synchronously in under 1ms. In API mode: Inputs are serialized to JSON, sent via HTTP POST to a 
          configurable endpoint, and the response is parsed and displayed with the same rendering logic.
        </p>

        <h3>Implementation Details</h3>
        <p>
          The logistic model uses these weights: age (+0.35), income (-1.10), debt ratio (+1.55), 
          late payments (+1.25), with a bias of -0.35. Inputs are normalized: age divided by 100, 
          income by 150,000, debt ratio used directly, late payments divided by 12. The sigmoid function 
          converts the linear combination into a probability. Risk thresholds: below 33% is low (green), 
          33-66% is medium (yellow), above 66% is high (red). The UI synchronizes number inputs with range 
          sliders bidirectionally using event listeners.
        </p>

        <h3>Technology Stack</h3>
        <p>
          <strong>Languages:</strong> Vanilla JavaScript (ES6+) for logic and DOM manipulation, HTML5 for structure, 
          CSS3 for styling with CSS Grid and custom properties. 
          <strong>Why:</strong> Zero build step, no dependencies, maximum portability, minimal load time, 
          complete browser compatibility without transpilation.
        </p>
        <p>
          <strong>Model:</strong> Logistic regression with explicit weight specification. 
          <strong>Why:</strong> Fully interpretable, no training data required, deterministic behavior, 
          easy to audit, suitable for demonstration and baseline comparison.
        </p>
        <p>
          <strong>API Integration:</strong> Fetch API with AbortController for timeout handling, JSON serialization. 
          <strong>Why:</strong> Native browser support, modern async/await patterns, no external HTTP library needed, 
          allows graceful degradation when API is unavailable.
        </p>
        <p>
          <strong>UI Components:</strong> Custom-built form controls, synchronized number/range inputs, 
          preset buttons, real-time status indicators. 
          <strong>Why:</strong> Full control over behavior and appearance, no framework overhead, 
          teaches fundamental DOM manipulation patterns.
        </p>

        <h3>Technical Challenges and Trade-offs</h3>
        <p>
          <strong>Challenge:</strong> Maintaining interpretability while providing meaningful risk scores. 
          <strong>Trade-off:</strong> Used hand-tuned weights instead of training on real data, sacrificing 
          predictive accuracy for complete transparency and auditability.
        </p>
        <p>
          <strong>Challenge:</strong> Supporting both local and API modes with a unified interface. 
          <strong>Trade-off:</strong> Duplicated some display logic but gained the ability to demonstrate 
          both lightweight and full-stack deployment scenarios without breaking changes.
        </p>
        <p>
          <strong>Challenge:</strong> Client-side JavaScript has no true type safety. 
          <strong>Trade-off:</strong> Implemented explicit validation and bounds checking at input time, 
          accepting runtime overhead to prevent invalid states from propagating through calculations.
        </p>
        <p>
          <strong>Challenge:</strong> API calls may fail or timeout. 
          <strong>Trade-off:</strong> Used AbortController with a 12-second timeout and structured error handling, 
          prioritizing user feedback over silent failures, at the cost of added code complexity.
        </p>
      </div>
    </section>

    <!-- Interactive Demo -->

    <section class="section">
      <h2>Interactive Demo</h2>
      <div class="demo-grid">

        <!-- Left: inputs + output -->
        <div class="card">
          <h2 style="margin:0 0 6px; font-size:18px;">Try it</h2>
          <p class="lead" style="font-size:14px; margin:0 0 4px;">
            Local mode uses a small logistic baseline (hand-tuned weights) for interpretability.
            API mode expects <span style="font-family:monospace;">POST /tabular/score</span> (optional).
          </p>

          <div class="chips" aria-label="Presets">
            <span class="chip" data-preset="low">Preset: low risk</span>
            <span class="chip" data-preset="mid">Preset: medium risk</span>
            <span class="chip" data-preset="high">Preset: high risk</span>
          </div>

          <div class="feature-form" aria-label="Feature inputs">
            <div class="field">
              <label for="age">Age <span class="hint">years</span></label>
              <input id="age" type="number" min="18" max="95" step="1" value="35" />
              <input id="ageR" type="range" min="18" max="95" step="1" value="35" />
            </div>

            <div class="field">
              <label for="income">Annual income <span class="hint">GBP</span></label>
              <input id="income" type="number" min="0" max="250000" step="1000" value="42000" />
              <input id="incomeR" type="range" min="0" max="250000" step="1000" value="42000" />
            </div>

            <div class="field">
              <label for="debt">Debt ratio <span class="hint">0.00 – 1.00</span></label>
              <input id="debt" type="number" min="0" max="1" step="0.01" value="0.28" />
              <input id="debtR" type="range" min="0" max="1" step="0.01" value="0.28" />
            </div>

            <div class="field">
              <label for="late">Late payments <span class="hint">count</span></label>
              <input id="late" type="number" min="0" max="24" step="1" value="1" />
              <input id="lateR" type="range" min="0" max="24" step="1" value="1" />
            </div>
          </div>

          <div class="actions" style="margin-top:14px; flex-wrap:wrap; gap:10px; align-items:center;">
            <button class="btn primary" id="btnRun" type="button">Score</button>
            <button class="btn" id="btnReset" type="button">Reset</button>
            <button class="btn" id="btnCopy" type="button">Copy JSON</button>

            <span class="toggle" role="group" aria-label="Mode selector">
              <button id="modeLocal" class="active" type="button">Local</button>
              <button id="modeApi" type="button">API</button>
            </span>

            <span class="status-badge warn" id="bMode">mode: local</span>
            <span class="status-badge" id="bStatus">status: idle</span>
            <span class="status-badge" id="bResult">risk: —</span>
          </div>

          <div class="risk-bar" aria-label="Risk score bar"><div id="barFill"></div></div>

          <div class="error-box" id="errBox" role="alert">
            <div id="errMsg" style="white-space:pre-wrap;"></div>
          </div>

          <div class="divider"></div>

          <h3 style="margin:0 0 8px; font-size:15px;">Output</h3>
          <pre class="output-pre" id="out">{}</pre>
        </div>

        <!-- Right: API shape + notes -->
        <div class="card">
          <h3 style="margin:0 0 12px; font-size:15px;">Links</h3>

          <a class="side-link" href="https://github.com/nepryoon/nil-tabular-risk" target="_blank" rel="noopener">
            <span>Repository</span><span class="kbd">GitHub</span>
          </a>

          <div class="divider"></div>

          <h3 style="margin:0 0 8px; font-size:15px;">API shape (optional)</h3>
          <pre class="output-pre">{
  "age": 35,
  "income_gbp": 42000,
  "debt_ratio": 0.28,
  "late_payments": 1
}</pre>

          <div class="divider"></div>

          <h3 style="margin:0 0 8px; font-size:15px;">Notes</h3>
          <ul style="margin:0; padding-left:18px; line-height:1.8; font-size:13px; color:rgba(255,255,255,.65);">
            <li>Local scoring is deterministic and intentionally simple.</li>
            <li>API mode uses the same payload and returns JSON.</li>
            <li>Values are illustrative — used only to demonstrate the workflow.</li>
          </ul>
        </div>

      </div>
    </section>

    <footer class="footer">
      <div>© 2025 Neuromorphic Inference Lab</div>
      <div class="prov">
        <span id="build-branch">branch: …</span>
        <span id="build-commit">commit: …</span>
        <span id="build-time">built: …</span>
      </div>
    </footer>
  </main>

  <script>
    const API_BASE = "https://api.neuromorphicinference.com";

    const el = {
      age: document.getElementById("age"),
      ageR: document.getElementById("ageR"),
      income: document.getElementById("income"),
      incomeR: document.getElementById("incomeR"),
      debt: document.getElementById("debt"),
      debtR: document.getElementById("debtR"),
      late: document.getElementById("late"),
      lateR: document.getElementById("lateR"),
      btnRun: document.getElementById("btnRun"),
      btnReset: document.getElementById("btnReset"),
      btnCopy: document.getElementById("btnCopy"),
      modeLocal: document.getElementById("modeLocal"),
      modeApi: document.getElementById("modeApi"),
      bMode: document.getElementById("bMode"),
      bStatus: document.getElementById("bStatus"),
      bResult: document.getElementById("bResult"),
      out: document.getElementById("out"),
      barFill: document.getElementById("barFill"),
      errBox: document.getElementById("errBox"),
      errMsg: document.getElementById("errMsg"),
    };

    let mode = "local";

    function setMode(next) {
      mode = next;
      el.modeLocal.classList.toggle("active", mode === "local");
      el.modeApi.classList.toggle("active", mode === "api");
      el.bMode.textContent = `mode: ${mode}`;
      el.bMode.className = "status-badge warn";
    }

    function setStatus(text, state) {
      el.bStatus.textContent = text;
      el.bStatus.className = "status-badge" + (state ? " " + state : "");
    }

    function showError(msg) {
      el.errMsg.textContent = msg;
      el.errBox.style.display = "block";
    }

    function hideError() {
      el.errMsg.textContent = "";
      el.errBox.style.display = "none";
    }

    function setResult(score, label, state) {
      if (score == null) {
        el.bResult.textContent = "risk: —";
        el.bResult.className = "status-badge";
        el.barFill.style.width = "0%";
        return;
      }
      const pct = Math.max(0, Math.min(100, Math.round(score * 100)));
      el.barFill.style.width = `${pct}%`;
      el.bResult.textContent = `risk: ${label} (${pct}%)`;
      el.bResult.className = "status-badge" + (state ? " " + state : "");
    }

    function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }
    function sigmoid(z) { return 1 / (1 + Math.exp(-z)); }

    function readInputs() {
      const age    = Number(el.age.value);
      const income = Number(el.income.value);
      const debt   = Number(el.debt.value);
      const late   = Number(el.late.value);
      if (!Number.isFinite(age) || !Number.isFinite(income) || !Number.isFinite(debt) || !Number.isFinite(late))
        throw new Error("Invalid numeric input.");
      if (age < 18 || age > 95)    throw new Error("Age must be between 18 and 95.");
      if (income < 0)               throw new Error("Income must be non-negative.");
      if (debt < 0 || debt > 1)    throw new Error("Debt ratio must be between 0 and 1.");
      if (late < 0)                 throw new Error("Late payments must be non-negative.");
      return { age, income_gbp: income, debt_ratio: debt, late_payments: late };
    }

    function localScore(payload) {
      const xAge    = clamp(payload.age / 100, 0, 1);
      const xIncome = clamp(payload.income_gbp / 150000, 0, 1);
      const xDebt   = clamp(payload.debt_ratio, 0, 1);
      const xLate   = clamp(payload.late_payments / 12, 0, 2);
      const wAge = 0.35, wIncome = -1.10, wDebt = 1.55, wLate = 1.25, b = -0.35;
      const z     = (wAge * xAge) + (wIncome * xIncome) + (wDebt * xDebt) + (wLate * xLate) + b;
      const score = sigmoid(z);
      let label = "low", state = "ok";
      if (score >= 0.66) { label = "high";   state = "bad"; }
      else if (score >= 0.33) { label = "medium"; state = "warn"; }
      const contribs = {
        age:           Number((wAge * xAge).toFixed(4)),
        income:        Number((wIncome * xIncome).toFixed(4)),
        debt_ratio:    Number((wDebt * xDebt).toFixed(4)),
        late_payments: Number((wLate * xLate).toFixed(4)),
        bias:          Number(b.toFixed(4)),
        logit_z:       Number(z.toFixed(4))
      };
      return { score, label, state, contribs };
    }

    async function fetchWithTimeout(url, opts = {}, ms = 12000) {
      const ctrl = new AbortController();
      const t = setTimeout(() => ctrl.abort(), ms);
      try {
        const res = await fetch(url, { ...opts, signal: ctrl.signal,
          headers: { "Accept": "application/json", ...(opts.headers || {}) } });
        clearTimeout(t); return res;
      } catch (e) { clearTimeout(t); throw e; }
    }

    async function run() {
      hideError();
      setStatus("status: running…", "warn");
      el.btnRun.disabled = true;
      try {
        const payload = readInputs();
        const t0 = performance.now();
        let result;

        if (mode === "local") {
          const s  = localScore(payload);
          const t1 = performance.now();
          result = {
            mode: "local", input: payload,
            output: { risk_score: Number(s.score.toFixed(4)), label: s.label },
            model: { type: "logistic-baseline", notes: "Hand-tuned weights for transparency." },
            explain: { contributions: s.contribs },
            latency_ms: Math.round(t1 - t0)
          };
          setResult(s.score, s.label, s.state);
          setStatus("status: done", "ok");
        } else {
          const r    = await fetchWithTimeout(`${API_BASE}/tabular/score`, {
            method: "POST", headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          const text = await r.text();
          const data = (() => { try { return JSON.parse(text); } catch { return { raw: text }; } })();
          if (!r.ok) {
            const detail = data?.detail ? (typeof data.detail === "string" ? data.detail : JSON.stringify(data.detail)) : null;
            throw new Error([`API error (HTTP ${r.status})`, detail ? `detail: ${detail}` : null].filter(Boolean).join("\n"));
          }
          const t1 = performance.now();
          result = { mode: "api", input: payload, response: data, latency_ms: Math.round(t1 - t0) };
          const s = Number(data?.risk_score ?? data?.score);
          const label = (data?.label && String(data.label).toLowerCase()) || null;
          if (Number.isFinite(s)) {
            const score = clamp(s, 0, 1);
            const derivedLabel = label || (score >= 0.66 ? "high" : score >= 0.33 ? "medium" : "low");
            const state = score >= 0.66 ? "bad" : score >= 0.33 ? "warn" : "ok";
            setResult(score, derivedLabel, state);
          } else { setResult(null, null, null); }
          setStatus("status: done", "ok");
        }

        el.out.textContent = JSON.stringify(result, null, 2);
      } catch (e) {
        const msg = String(e?.message || e);
        showError(msg);
        el.out.textContent = JSON.stringify({ error: msg }, null, 2);
        setStatus("status: error", "bad");
        setResult(null, null, null);
      } finally { el.btnRun.disabled = false; }
    }

    function resetDefaults() {
      el.age.value = "35";    el.ageR.value = "35";
      el.income.value = "42000"; el.incomeR.value = "42000";
      el.debt.value = "0.28"; el.debtR.value = "0.28";
      el.late.value = "1";    el.lateR.value = "1";
      el.out.textContent = "{}";
      hideError();
      setStatus("status: idle", null);
      setResult(null, null, null);
    }

    function syncPair(a, b) {
      a.addEventListener("input", () => { b.value = a.value; });
      b.addEventListener("input", () => { a.value = b.value; });
    }
    syncPair(el.age, el.ageR);
    syncPair(el.income, el.incomeR);
    syncPair(el.debt, el.debtR);
    syncPair(el.late, el.lateR);

    document.querySelectorAll(".chip").forEach(ch => {
      ch.addEventListener("click", () => {
        const p = ch.getAttribute("data-preset");
        if (p === "low")  { el.age.value="42";  el.ageR.value="42";  el.income.value="78000"; el.incomeR.value="78000"; el.debt.value="0.18"; el.debtR.value="0.18"; el.late.value="0"; el.lateR.value="0"; }
        if (p === "mid")  { el.age.value="33";  el.ageR.value="33";  el.income.value="42000"; el.incomeR.value="42000"; el.debt.value="0.38"; el.debtR.value="0.38"; el.late.value="2"; el.lateR.value="2"; }
        if (p === "high") { el.age.value="26";  el.ageR.value="26";  el.income.value="26000"; el.incomeR.value="26000"; el.debt.value="0.72"; el.debtR.value="0.72"; el.late.value="8"; el.lateR.value="8"; }
        setStatus("status: preset loaded", null);
      });
    });

    el.modeLocal.addEventListener("click", () => setMode("local"));
    el.modeApi.addEventListener("click",   () => setMode("api"));
    el.btnRun.addEventListener("click",    run);
    el.btnReset.addEventListener("click",  resetDefaults);
    el.btnCopy.addEventListener("click",   async () => {
      try {
        await navigator.clipboard.writeText(el.out.textContent || "{}");
        setStatus("status: copied", "ok");
        setTimeout(() => setStatus("status: idle", null), 900);
      } catch { setStatus("status: copy failed", "warn"); }
    });

    window.addEventListener("load", () => resetDefaults());
  </script>

  <script src="/build-info.js"></script>
</body>
</html>
